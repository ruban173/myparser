var events_module=function(){var r="",o="",a={},c=!0,s=new Date,u=0,d=!1,l=0,_=0,v=0,f=0,m=0,p=0,g={},w="events_module_next_page_data",x="events_stat_user_id",h="events_stat_ses_id",y=10,b=new Date,S={active:0,scroll:0},I=!1,E={scroll:!1,click:!1,keypress:!1,mousemove:!1},k=function(){},A=function(){},P=5,C=1e3*P,T=K(q,C),O=Y(T,100),N=Y(function(){q({forceInactiveSending:!0})},100),D=!1;function M(){v=z()}function V(e,t){return Math.floor(e/t)*t}function n(){return e(G(new Date-b))}function L(){b=new Date}function U(){var e=X(Math.floor(m/60)*P+P);C<e&&(T=K(q,C=e))}function B(e){t(e.event,e.in_c_type_id,e.in_c_id,e.in_c_npp,e.event_lentime,e.event_int8,e.event_str)}function J(){var t=!1;return W(E,function(e){if(e)return t=!0}),t}function R(){return I||J()}function t(e,t,n,i,r,o,a){if(!e)throw new Error("event is required argument");var c=e+"_"+t+"_"+n+"_"+i,s=!g.hasOwnProperty(c),u=s?z():g[c].event_starttime;g[c]={event:e,in_c_type_id:t||0,in_c_id:n||0,in_c_npp:i||0,event_starttime:u,event_lentime:r||0,event_int8:o||0,event_str:a||""},(s?N:O)()}function q(e){var t;e=e||{},z()>u||(e.forceInactiveSending||R())&&0!==H().length&&(e.doNotUpdateTime||(!R()||(t=n())&&(m-=S.active,S.active=t,m+=S.active,U()),!E.scroll||(t=n())&&(f-=S.scroll,S.scroll=t,f+=S.scroll),M()),j(r,{pageViewUuid:o,time_onpage:v,start_page_view:c,data:F(i())},function(){},function(e){console.error("failed to send events",e)}),c=c&&!1)}function i(){return{events:H(),pageViewUuid:o,params:a,url:window.location.href,user_id:l,ses_id:_,user_ses_start:d,time_onpage:v,time_onpage_last_scroll:f,time_onpage_active:m,view_el_max:p}}function H(){var e,t=[];for(e in g)g.hasOwnProperty(e)&&t.push(g[e]);return t}function j(e,t,n,i){var r=new XMLHttpRequest;r.open("POST",e),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.send(function(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(t+"="+e[t]);return n.join("&")}(t)),r.onload=function(){(200==+r.status?n:i)()},r.onerror=i}function W(e,t){for(var n in e)if(e.hasOwnProperty(n))if(t(e[n],n,e))return}function F(e){return encodeURIComponent(JSON.stringify(e))}function z(){return e(G(new Date-s))}function e(e){return function(e,t){t=Math.pow(10,t);return Math.round(e*t)/t}(e,0)}function G(e){return e/1e3}function X(e){return 1e3*e}function Y(i,r,o){var a;return function(){var e=this,t=arguments,n=o&&!a;clearTimeout(a),a=setTimeout(function(){a=null,o||i.apply(e,t)},r),n&&i.apply(e,t)}}function K(e,t){var n=!1;return function(){n||(e.apply(this,arguments),n=!0,setTimeout(function(){n=!1},t))}}function Q(e,t,n){var i,r="";n&&((i=new Date).setTime(i.getTime()+24*n*60*60*1e3),r="; expires="+i.toUTCString()),document.cookie=e+"="+(t||"")+r+"; path=/"}function Z(e){for(var t=e+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var r=n[i];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(t))return r.substring(t.length,r.length)}return null}return{init:function(e){d=!(c=!0),g={};for(var t=["statServerAddr","pageViewUuid"],n=p=m=f=v=_=l=u=s=0;n<t.length;n++)if(!e[t[n]])throw new Error("required option is missing: "+t[n]);var i=Z(x);i||(i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),Q(x,i,3650)),l=i,_=function(){var e=Z(h);if(!e)return t();try{e=JSON.parse(e)}catch(e){return console.error("Incorrect JSON during getSesId",e),t()}return new Date>new Date(e.expires)?t():t(e.sesId);function t(e){void 0===e&&(d=!0);var t,e=e||(t=0,n=65535,t=Math.ceil(t),n=Math.floor(n),Math.floor(Math.random()*(n-t+1))+t),n=JSON.stringify({sesId:e,expires:(new Date).valueOf()+9e5});return t=h,document.cookie=t+"=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;",Q(h,n,15/1440),e}}(),s=new Date,b=new Date,r=e.statServerAddr,o=e.pageViewUuid,a=e.addParams||{},u=e.sendTimeLimitInSec||900,"function"==typeof e.onPrevWasActiveChange&&(k=e.onPrevWasActiveChange)(I),"function"==typeof e.onIsActiveChange&&(A=e.onIsActiveChange)(J()),T=K(q,C=1e3*P),D||(L(),document.addEventListener("scroll",function(){E.scroll=!0,A(!0)},{passive:!0}),document.addEventListener("click",function(){E.click=!0,A(!0)},{passive:!0}),document.addEventListener("keypress",function(){E.keypress=!0,A(!0)},{passive:!0}),document.addEventListener("mousemove",Y(function(){E.mousemove=!0,A(!0)},100),{passive:!0}),setInterval(function(){R()&&(m=V(m,y)+y,S.active=y,U()),E.scroll&&(f=V(f,y)+y,S.scroll=y),M(),W(S,function(e,t){S[t]=0}),L(),T({doNotUpdateTime:!0}),I=J(),k(I),W(E,function(e,t){E[t]=!1}),A(!1)},1e4),function(){var e=window.ib_stat_v2_events;if(e&&function(e){return"[object Array]"===Object.prototype.toString.call(e)}(e))for(var t=0;t<e.length;t++){var n=e[t];(function(e){return null!==e&&("object"==typeof e&&"function"!=typeof e)})(n)&&n.hasOwnProperty("event")?B(n):console.error("invalid argument in ib_stat_v2_events",n)}!function(){var e=[];Object.defineProperty(e,"push",{enumerable:!1,configurable:!1,writable:!1,value:B}),window.ib_stat_v2_events=e}()}(),function(){var e,t=window.localStorage.getItem(w);if(!t)return;try{e=JSON.parse(t)}catch(e){return window.localStorage.removeItem(w),console.error("Incorrect JSON during sendEventsForNextPage",e)}e.data=F(e.data),j(r,e,function(){window.localStorage.removeItem(w)},function(e){console.error("failed to send events data data",e)})}(),D=!0)},add_event:t,getEvents:H,requestData:i,userIsActive:R,saveEventsForSendingOnNextPage:function(){var e={data:i(),time_onpage:v,pageViewUuid:o,from_cookie:!0};window.localStorage.setItem(w,JSON.stringify(e))},set_view_el_max:function(e){p=Math.max(p,e)}}}(),blocks_seen_stat_v2=function(){var s,u=[],d="",l="",_="",v={},f="",m=!1,p={},a={name:{PageView:"PageView",PageViewRet:"PageViewRet",PageViewExt:"PageViewExt",InSeen:"InSeen",InClick:"InClick"}},g=a.name.PageView,n=18e5,e=36e5,c=1e3,w=1500,t=1,x=1,i=.5,h=.5,y=3600,r=60,o=!0;function b(){return P()?i:t}function S(){var e=P()?c:w,t=b();C();for(var n=0,i=0;i<u.length;i++){var r=k(i),o=A(i,r);V(L(o))||J(o,t)&&function(i,r,o,e){R(function(){var e,t,n;J(i,P()?h:x)&&(n={in_c_type_id:e=U(i),in_c_id:t=B(i),position:o+1,seen_total:r/1e3},p[L(i)]=n,n=M(a.name.InSeen,e,t,n.position,n.seen_total),events_module.set_view_el_max(i.getAttribute("data-"+d)||0),events_module.add_event(n.event,n.in_c_type_id,n.in_c_id,n.in_c_npp,n.event_lentime),m&&(n=o,document.getElementById("seen_block_bar_v2_"+n).style.backgroundColor="yellow"))},r*e)()}(o,e,r,++n)}}function I(){if(events_module.userIsActive())for(var e=0;e<u.length;e++){var t=u[e],n=L(t);V(n)&&J(t,b())&&function(e,t){var n=function(e){return function(e,t){t=Math.pow(10,t);return Math.round(e*t)/t}(e,0)}(p[e].seen_total+E/1e3),e=p[e];e.seen_total=Math.min(n,r);n=M(a.name.InSeen,e.in_c_type_id,e.in_c_id,e.position,e.seen_total);events_module.add_event(n.event,n.in_c_type_id,n.in_c_id,n.in_c_npp,n.event_lentime),m&&(document.getElementById("seen_block_bar_v2_"+t).innerText=e.seen_total)}(n,e)}}var E=1100;function k(e){return o?e:u.length-1-e}function A(e,t){return o?u[e]:u[t]}function P(){return Math.min(window.innerWidth,window.innerHeight)<500}function C(){var e,t;void 0!==C.lastScrollTop?(e=window.pageYOffset||document.documentElement.scrollTop)!==C.lastScrollTop&&(t=!1,e>C.lastScrollTop&&(t=!0),C.lastScrollTop=e<=0?0:e,o=t):C.lastScrollTop=0}function T(e){var t;m&&(t=e,document.getElementById("seen_bar_v2_isActive").style.backgroundColor=t?"lightgreen":"white"),e&&(new Date-s>n?(g=a.name.PageViewRet,W(window.blocks_seen_stat_params_v2)):s=new Date)}function O(){O.intervalId&&clearInterval(O.intervalId),O.intervalId=setInterval(N,e)}function N(){g=a.name.PageViewExt,W(window.blocks_seen_stat_params_v2)}function D(e){document.getElementById("seen_bar_v2_wasActive").style.backgroundColor=e?"lightgreen":"white"}function M(e,t,n,i,r){return{event:e,in_c_type_id:t,in_c_id:n,in_c_npp:i,event_lentime:r,event_int8:0,event_str:""}}function V(e){return p.hasOwnProperty(e)}function L(e){return U(e)+"_"+B(e)}function U(e){return e.getAttribute("data-"+l)}function B(e){return e.getAttribute("data-"+_)}function J(e,t){var n=e.offsetHeight,t=Math.min(n*t,window.innerHeight/2),e=e.getBoundingClientRect().top;return e<0?t<=e+n:window.innerHeight-e>=t}function R(i,r,o){var a;return function(){var e=this,t=arguments,n=o&&!a;clearTimeout(a),a=setTimeout(function(){a=null,o||i.apply(e,t)},r),n&&i.apply(e,t)}}function q(){for(var e=0;e<u.length;e++){var t=k(e)+1,n=A(e,t);n.addEventListener("click",function(t,n){return function(){var e,e=M(a.name.InClick,U(t),B(t),n,V(e=L(t))?p[e].seen_total:0);events_module.add_event(e.event,e.in_c_type_id,e.in_c_id,e.in_c_npp,e.event_lentime),events_module.saveEventsForSendingOnNextPage()}}(n,t))}}function H(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}var j=!1;function W(e){if(e){for(var t=["statServerAddr","blockClassName","in_c_type_id_dataAttrName","in_c_id_dataAttrName","viewElDataAttrName"],n=0;n<t.length;n++)if(!e[t[n]])throw new Error("lib init error - required option is missing: "+t[n]);new Date,s=new Date,p={},u=document.getElementsByClassName(e.blockClassName),d=e.viewElDataAttrName,l=e.in_c_type_id_dataAttrName,_=e.in_c_id_dataAttrName,v=e.addParams||{},f=!f&&e.pageViewUuid||H();var i,r,o,a,c=T;e.debugBar&&(m=!0,function(){var e=document.getElementById("seen_bar_v2");e&&e.remove();var t=document.createElement("div");t.id="seen_bar_v2",t.title="v2",t.style.position="fixed",t.style.right="0",t.style.top="0",t.style.backgroundColor="white",t.style.width="25px";var n=document.createElement("div");n.id="seen_bar_v2_activityBar",n.style.fontSize="9px",t.appendChild(n),["seen_bar_v2_wasActive","seen_bar_v2_isActive"].forEach(function(e){var t=document.createElement("span");t.id=e,t.style.display="inline-block",t.style.width="50%",t.style.textAlign="center",t.innerText="*",t.title=e,n.appendChild(t)});for(var i=0;i<u.length;i++){var r=document.createElement("div");r.id="seen_block_bar_v2_"+i,r.innerText="---",r.style.fontSize="9px",r.style.backgroundColor="grey",t.appendChild(r)}document.body.appendChild(t)}(),i=D),events_module.init({sendTimeLimitInSec:y,statServerAddr:e.statServerAddr,pageViewUuid:f,addParams:v,onIsActiveChange:c,onPrevWasActiveChange:i}),events_module.add_event(g),O(),j||(r=S,a=!(o=500),i=function(){a||(r.apply(this,arguments),a=!0,setTimeout(function(){a=!1},o))},window.addEventListener("scroll",R(i,250),{passive:!0}),setInterval(i,500),i(),setInterval(I,E),q(),j=!0)}}return"interactive"===document.readyState||"complete"===document.readyState?W(window.blocks_seen_stat_params_v2):document.addEventListener("DOMContentLoaded",function(){W(window.blocks_seen_stat_params_v2)}),{}}();